const { IconModule } = require('./icon-module');

class IconCollectionModule extends IconModule {
  constructor(modules) {
    super(modules);
    this.childModules = [];
  }

  get importPath() {
    return `./${this.modules[this.modules.length - 1]}/${this.outputFileBaseName}`;
  }

  addModules(iconModules) {
    this.childModules.push(...iconModules);
    return this;
  }

  _normaliseName() {
    const name = this.modules
      .join('/')
      .replace(/[^a-zA-Z0-9]+/g, '-');
    return `icon-collection-${name}`;
  }

  async _angularTemplate() {
    const modules = this.childModules
      .map(m => `    ${m.moduleName},`)
      .join('\n');
    const imports = this.childModules
      .sort((a, b) => a.importPath.localeCompare(b.importPath))
      .map(m => `import { ${m.moduleName} } from '${m.importPath}';`)
      .join('\n');
    return `/*
 * Don't delete this file, it's autogenerated by the ACL icons build script
 */
import { NgModule } from '@angular/core';

${imports}

@NgModule({
  imports: [
${modules}
  ],
  exports: [
${modules}
  ]
})
export class ${this.moduleName} { }
`;
  }
}

exports.IconCollectionModule = IconCollectionModule;
