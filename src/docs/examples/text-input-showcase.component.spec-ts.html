<span class="hljs-keyword">import</span> { ChangeDetectionStrategy, DebugElement } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-keyword">async</span>, ComponentFixture, TestBed } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;
<span class="hljs-keyword">import</span> { By } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;
<span class="hljs-keyword">import</span> { FormsModule, ReactiveFormsModule } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;
<span class="hljs-keyword">import</span> { FieldModule } <span class="hljs-keyword">from</span> <span class="hljs-string">'sbb-angular'</span>;
<span class="hljs-keyword">import</span> { InputFieldShowcaseComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'./text-input-showcase.component'</span>;
<span class="hljs-keyword">import</span> { CheckboxModule } <span class="hljs-keyword">from</span> <span class="hljs-string">'projects/sbb-angular/src/public_api'</span>;

describe(<span class="hljs-string">'InputFieldShowcaseComponent'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

  <span class="hljs-keyword">let</span> component: InputFieldShowcaseComponent;
  <span class="hljs-keyword">let</span> fixture: ComponentFixture&lt;InputFieldShowcaseComponent&gt;;
  <span class="hljs-keyword">let</span> debugElement: DebugElement;

  beforeEach(<span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    TestBed.configureTestingModule({
      imports: [FormsModule, ReactiveFormsModule, FieldModule, CheckboxModule],
      declarations: [InputFieldShowcaseComponent]
    })
    .overrideComponent(InputFieldShowcaseComponent, {
      <span class="hljs-keyword">set</span>: { changeDetection: ChangeDetectionStrategy.Default }
    })
    .compileComponents();
  }));

  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    fixture = TestBed.createComponent(InputFieldShowcaseComponent);
    component = fixture.componentInstance;
    debugElement = fixture.debugElement;
  });

  it(<span class="hljs-string">'should create'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    expect(component).toBeTruthy();
  });

  it(<span class="hljs-string">'should bind the input to the correct property'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-comment">// first round of change detection ...</span>
      fixture.detectChanges();
      <span class="hljs-comment">// get the input element ...</span>
      <span class="hljs-keyword">const</span> input = debugElement.query(By.css(<span class="hljs-string">'#simpleInput'</span>));
      <span class="hljs-keyword">const</span> inputElement = input.nativeElement;
      <span class="hljs-comment">// set its value ...</span>
      inputElement.value = <span class="hljs-string">'test value'</span>;
      inputElement.dispatchEvent(<span class="hljs-keyword">new</span> Event(<span class="hljs-string">'input'</span>));
      <span class="hljs-comment">// do the comparison ...</span>
      expect(component.inputText).toBe(<span class="hljs-string">'test value'</span>);
  });

  it(<span class="hljs-string">'should bind the input to the correct input type'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-comment">// first round of change detection ...</span>
      fixture.detectChanges();
      <span class="hljs-comment">// get the input element ...</span>
      <span class="hljs-keyword">const</span> input = debugElement.query(By.css(<span class="hljs-string">'#simpleInput'</span>));
      <span class="hljs-keyword">const</span> inputElement = input.nativeElement;
      <span class="hljs-comment">// do the comparison ...</span>
      expect(inputElement.type).toBe(<span class="hljs-string">'text'</span>);
      expect(component.inputType).toBe(<span class="hljs-string">'text'</span>);
  });

  it(<span class="hljs-string">'should be readonly attribute'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     component.readonly = <span class="hljs-literal">true</span>;
     <span class="hljs-comment">// first round of change detection ...</span>
     fixture.detectChanges();
     expect(fixture.debugElement.nativeElement.querySelector(<span class="hljs-string">'[readonly]'</span>)).toBeTruthy();
  });

  it(<span class="hljs-string">'should have at least 7 types of input type'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-comment">// first round of change detection ...</span>
      fixture.detectChanges();
      expect(component.types).toEqual([<span class="hljs-string">'text'</span>, <span class="hljs-string">'password'</span>, <span class="hljs-string">'number'</span>, <span class="hljs-string">'file'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'datetime'</span>, <span class="hljs-string">'datetime-local'</span>]);
  });

  it(<span class="hljs-string">'should have password in model input type'</span>, <span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">// change model ...</span>
     component.inputType = component.types[<span class="hljs-number">1</span>];
     component.placeholder = component.placeholderPassword;
     fixture.detectChanges();
     <span class="hljs-keyword">const</span> select = fixture.debugElement.query(By.css(<span class="hljs-string">'#dropdown'</span>)).nativeElement;
     <span class="hljs-comment">// do the comparison ...</span>
     expect(select).toBeTruthy();
     expect(component.inputType).toBe(component.types[<span class="hljs-number">1</span>]);
     expect(component.placeholder).toBe(component.placeholderPassword);
  }));

  it(<span class="hljs-string">'should have number in model input type'</span>, <span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">// change model ...</span>
    component.inputType = component.types[<span class="hljs-number">2</span>];
    component.placeholder = component.placeholderNumber;
    fixture.detectChanges();
    <span class="hljs-keyword">const</span> select = fixture.debugElement.query(By.css(<span class="hljs-string">'#dropdown'</span>)).nativeElement;
    <span class="hljs-comment">// do the comparison ...</span>
    expect(select).toBeTruthy();
    expect(component.inputType).toBe(component.types[<span class="hljs-number">2</span>]);
    expect(component.placeholder).toBe(component.placeholderNumber);
  }));

  it(<span class="hljs-string">'should have file in model input type'</span>, <span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">// change model ...</span>
     component.inputType = component.types[<span class="hljs-number">3</span>];
     fixture.detectChanges();
     <span class="hljs-keyword">const</span> select = fixture.debugElement.query(By.css(<span class="hljs-string">'#dropdown'</span>)).nativeElement;
     <span class="hljs-comment">// do the comparison ...</span>
     expect(select).toBeTruthy();
     expect(component.inputType).toBe(component.types[<span class="hljs-number">3</span>]);
  }));

  it(<span class="hljs-string">'should have email in model input type'</span>, <span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">// change model ...</span>
     component.inputType = component.types[<span class="hljs-number">4</span>];
     component.placeholder = component.placeholderEmail;
     fixture.detectChanges();
     <span class="hljs-keyword">const</span> select = fixture.debugElement.query(By.css(<span class="hljs-string">'#dropdown'</span>)).nativeElement;
     <span class="hljs-comment">// do the comparison ...</span>
     expect(select).toBeTruthy();
     expect(component.inputType).toBe(component.types[<span class="hljs-number">4</span>]);
     expect(component.placeholder).toBe(component.placeholderEmail);
  }));

  it(<span class="hljs-string">'should have date-time in model input type'</span>, <span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">// change model ...</span>
     component.inputType = component.types[<span class="hljs-number">5</span>];
     component.placeholder = component.placeholderDatetime;
     fixture.detectChanges();
     <span class="hljs-keyword">const</span> select = fixture.debugElement.query(By.css(<span class="hljs-string">'#dropdown'</span>)).nativeElement;
     <span class="hljs-comment">// do the comparison ...</span>
     expect(select).toBeTruthy();
     expect(component.inputType).toBe(component.types[<span class="hljs-number">5</span>]);
     expect(component.placeholder).toBe(component.placeholderDatetime);
  }));

  it(<span class="hljs-string">'should have datetime-local in model input type'</span>, <span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">// change model ...</span>
     component.inputType = component.types[<span class="hljs-number">6</span>];
     fixture.detectChanges();
     <span class="hljs-keyword">const</span> select = fixture.debugElement.query(By.css(<span class="hljs-string">'#dropdown'</span>)).nativeElement;
     <span class="hljs-comment">// do the comparison ...</span>
     expect(select).toBeTruthy();
     expect(component.inputType).toBe(component.types[<span class="hljs-number">6</span>]);
  }));

  it(<span class="hljs-string">'should have text in model input type'</span>, <span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">// change model ...</span>
     component.inputType = component.types[<span class="hljs-number">0</span>];
     component.placeholder = component.placeholderText;
     fixture.detectChanges();
     <span class="hljs-keyword">const</span> select = fixture.debugElement.query(By.css(<span class="hljs-string">'#dropdown'</span>)).nativeElement;
     <span class="hljs-comment">// do the comparison ...</span>
     expect(select).toBeTruthy();
     expect(component.inputType).toBe(component.types[<span class="hljs-number">0</span>]);
     expect(component.placeholder).toBe(component.placeholderText);
  }));

  it(<span class="hljs-string">'should have attribute disabled'</span>, <span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-comment">// change model ...</span>
    component.disabled = <span class="hljs-literal">true</span>;
    fixture.detectChanges();
    <span class="hljs-keyword">const</span> select = fixture.debugElement.query(By.css(<span class="hljs-string">'#dropdown'</span>)).nativeElement;
    <span class="hljs-comment">// do the comparison ...</span>
    expect(select).toBeTruthy();
    expect(select.disabled).toBeFalsy();
  }));

  it(<span class="hljs-string">'should have attribute readonly'</span>, <span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-comment">// change model ...</span>
    component.readonly = <span class="hljs-literal">true</span>;
    fixture.detectChanges();
    <span class="hljs-keyword">const</span> select = fixture.debugElement.query(By.css(<span class="hljs-string">'#dropdown'</span>)).nativeElement;
    <span class="hljs-comment">// do the comparison ...</span>
    expect(select).toBeTruthy();
    expect(select.readonly).toBeFalsy();
  }));

});
